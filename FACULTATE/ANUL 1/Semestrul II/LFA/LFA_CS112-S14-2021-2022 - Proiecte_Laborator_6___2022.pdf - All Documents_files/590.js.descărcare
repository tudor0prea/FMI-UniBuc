(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[590],{1840:function(e,t,n){"use strict";n.r(t);n.d(t,"PolicyTipAction",function(){return s});var r=n(2613),i=n(144),s=Object(r.e)(function(e,t){var n=e.consume(i.e);return new(e.injected(n.PolicyTipAction))({item:t.item})})},2011:function(e,t,n){"use strict";n.r(t);n.d(t,"focusFirstTabStop",function(){return i});n.d(t,"focusLastTabStop",function(){return s});n.d(t,"focusNextTabStop",function(){return o});n.d(t,"focusPreviousTabStop",function(){return u});n.d(t,"getFirstTabStop",function(){return a});n.d(t,"getLastTabStop",function(){return f});n.d(t,"getNextTabStop",function(){return l});n.d(t,"getPreviousTabStop",function(){return c});n.d(t,"isTabStop",function(){return h});var r=n(208);function i(e,t){p(e,a,t)}function s(e,t){p(e,f,t)}function o(e,t){p(e,l,t)}function u(e,t){p(e,c,t)}function a(e,t){return e&&g(e,t)}function f(e,t){return e&&y(e,t)}function l(e,t){return e&&(m(e.firstElementChild,d,g,t)||b(e,d,g,t))}function c(e,t){return e&&b(e,v,y,t)}function h(e,t){return!(!e||!E(e,t))}function p(e,t,n){var r=t(e,n);r&&r.focus()}function d(e){return e.nextElementSibling}function v(e){return e.previousElementSibling}function m(e,t,n,r){for(;e;e=t(e)){var i=n(e);if(i)return i}}function g(e,t){return E(e,t)||m(e.firstElementChild,d,g)}function y(e,t){return m(e.lastElementChild,v,y)||E(e,t)}function b(e,t,n,i){for(;e;e=Object(r.e)(e)){var s=m(t(e),t,n);if(s)return s}}var w={a:1,input:1,area:1,button:1,select:1,textarea:1,object:1};function E(e,t){var n=e.tagName.toLowerCase();if((n in w||void 0!==e.attributes.tabindex)&&(-1!==e.tabIndex||t)&&"true"!==e.getAttribute("aria-hidden")&&"none"!==e.style.display.toLowerCase()&&"hidden"!==e.style.visibility.toLowerCase()&&!(0===e.offsetWidth&&0===e.offsetHeight||e.disabled||"input"===n&&"hidden"===e.type.toLowerCase()))return e}},2020:function(e,t,n){"use strict";n.d(t,"e",function(){return c});var r=n(0),i=n(1065),s=n(101),o=n(59),u=n("knockout-lib"),a=(function(){function e(e){var t=this,n=e.noTitle,r=void 0!==n&&n,i=e.title,s=void 0===i?u.observable(""):i,a=e.elementDescribedBy,f=void 0===a?"":a,l=e.hasCommandBar,c=void 0!==l&&l,h=e.size,p=void 0===h?"Small":h,d=e.scrollMode,v=void 0===d?"auto":d,m=e.showCloseButton,g=void 0===m||m,y=e.includePadding,b=void 0===y||y,w=e.preserveLightDismiss,E=void 0!==w&&w,S=e.stickyCloseButton,x=void 0!==S&&S,T=e.component,N=void 0===T?null:T,C=e.maximizePanelContent,k=void 0!==C&&C,L=e.panelContentSize,A=void 0===L?u.observable({width:0,height:0}):L,O=e.isBlocking,M=e.disableEscape,_=void 0!==M&&M,D=e.overridePanelStyle;this.size=p;this.title=u.isObservable(s)?s:u.observable(s);this.elementDescribedBy=f;this.maximizePanelContent=k;this.panelContentSize=A;this.noTitle=r;this.hasCommandBar=c;this.component=N;this.scrollMode=v;this.showCloseButton=g;this.includePadding=b;this.preserveLightDismiss=E;this.stickyCloseButton=x;this.isBlocking=O;this.disableEscape=_;this.overridePanelStyle=D;this.state=u.observable(0);this._promise=new o.n(function(e){var n=u.computed(function(){if(1===t.state()){e(!0);n.dispose()}},t)})}e.prototype.wait=function(){return this._promise};return e})(),f=n(2112),l=(function(e){Object(r.__extends)(t,e);function t(t,n){var r=e.call(this,t,n)||this;r.currentPanels=r.observables.createArray();r._needsOverlayContent=n.needsOverlayContent;return r}t.prototype.requestPanel=function(e){this._needsOverlayContent.needsOverlayContent.set(!0);var t=new a(e),n=this.currentPanels;n.push(t);var r=function(){return n.remove(t)};t.wait().then(r,r);return t};t.dependencies=Object(r.__assign)(Object(r.__assign)({},i.default.dependencies),{needsOverlayContent:f.e});return t})(i.default),c=Object(s.s)("PanelProvider",l)},2081:function(e,t,n){"use strict";var r=n(0),i=n(1961),s=n("knockout-lib"),o=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this;n.controlsDescendantBindings=!0;n.createComputed(n._computeRefreshChildElements);return n}t.prototype._computeRefreshChildElements=function(){var e=s.unwrap(this.valueAccessor());s.virtualElements.emptyNode(this.element);this.element.innerHTML=e;s.applyBindingsToDescendants(this.bindingContext,this.element)};return t})(i.t);t.e=o},2312:function(e,t,n){"use strict";n.d(t,"e",function(){return s});n.d(t,"t",function(){return o});n.d(t,"n",function(){return u});n.d(t,"r",function(){return a});var r=n(2555),i=n(18);function s(){return r.g}function o(e){return i.format(r.u,"'".concat(e,"'"))}function u(e,t){var n=r.o,i=a(e,4),s=a(e,2),o=a(e,1);i?n=r.f:s?n=r.o:o&&(n=r.a);t&&(n+=' <a href=";" data-bind="click: '.concat(t,'">').concat(r.g,"</a>"));return n}function a(e,t){return e&&(e&t)===t}},2567:function(e,t,n){"use strict";var r=n(0),i=n(127),s=n(1192),o=n(1978),u=n(2616),a=n(2555),f=n(2312),l=n(72),c=n(2003),h=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this,r=t.item,i=t.policyTipInfo;n._item=r;n._policyTipInfo=i;n.addBindingHandlers({react:c.t});n._itemProvider=n.resources.consume(o.resourceKey);n._policyTipDataSource=n.resources.consume(l.z);n._showJustificationInput=n.createObservable(!1);n._confirmationText=n.createObservable("").extend({notify:"always"});n.policyTipComponent=u.e;n.policyTipComponentProps=n.createPureComputed(n._computePolicyTipComponentParams);return n}t.prototype._computePolicyTipComponentParams=function(){var e=this._confirmationText(),t=this._showJustificationInput(),n=this._getPolicyTipStrings();return{confirmationText:e,onDismissed:this._onDismissed.bind(this),onOverrideClicked:this._onOverrideClicked.bind(this),onOverrideSubmitClicked:this._onOverrideSubmitClicked.bind(this),overrideRequiresJustification:this._policyTipInfo?2===this._policyTipInfo.overrideOption:void 0,showJustificationInput:t,onReportClicked:this._onReportClicked.bind(this),strings:n}};t.prototype._getPolicyTipStrings=function(){var e=this._policyTipInfo;if(!e)return{noPolicyTipInfoError:a.n,titleText:f.t(this._item.name),headerText:void 0,issues:void 0,lastScannedText:void 0,learnMoreActionLabel:void 0,learnMoreLabel:void 0,learnMoreUrl:void 0,overrideActionLabel:void 0,overrideLabel:void 0,policyTipDescription:void 0,reportActionLabel:void 0,reportInProgressLabel:void 0,reportLabel:void 0,submitButtonLabel:void 0};var t=1===e.overrideOption||2===e.overrideOption;return{headerText:a.v,issues:e.issueDescriptions,lastScannedText:e.lastScanned?"".concat(a.m,": ").concat(Object(s.i)(e.lastScanned)):void 0,learnMoreActionLabel:a.e,learnMoreLabel:a.t,learnMoreUrl:e.policyInfoUrl,noPolicyTipInfoError:void 0,overrideActionLabel:t?a.r:void 0,overrideLabel:a.s,policyTipDescription:e.explanationText,reportActionLabel:a.l,reportInProgressLabel:a.h,reportLabel:a.p,submitButtonLabel:a.d,titleText:f.t(this._item.name)}};t.prototype._onReportClicked=function(){var e=this;this._logEngagementEvent("ReportClicked");var t={item:this._item,action:1};this._policyTipDataSource.updatePolicy(t).done(function(t){if(1===t){e._logEngagementEvent("FalsePositiveReported");e._confirmationText(a.c)}else if(3===t||2===t){e._logEngagementEvent("OverrideWithoutJustification");e._confirmationText(a.i)}})};t.prototype._onOverrideClicked=function(){var e=this;this._logEngagementEvent("OverrideClicked");var t=this._policyTipInfo.overrideOption;if(1===t){var n={item:this._item,action:0};this._policyTipDataSource.updatePolicy(n).done(function(t){e._logEngagementEvent("OverrideWithoutJustification");e._confirmationText(a.i)})}else if(2===t){this._logEngagementEvent("JustificationInputShown");this._showJustificationInput(!0)}};t.prototype._onOverrideSubmitClicked=function(e){var t=this;this._logEngagementEvent("OverrideSubmitClicked");var n={item:this._item,action:0,justification:e};this._policyTipDataSource.updatePolicy(n).done(function(e){t._logEngagementEvent("OverrideWithJustification");t._confirmationText(a.i)})};t.prototype._onDismissed=function(){this._itemProvider.invalidateItem(this._item.parentKey,{triggerFetch:!0})};t.prototype._logEngagementEvent=function(e){i.e.logData({name:"PolicyTipPanel.".concat(e)})};return t})(n(1959).t),p=n(1960).e({tagName:"od-policy-tip-panel",template:'<div data-bind="react:{componentType:policyTipComponent,props:policyTipComponentProps}"></div>',viewModel:h});t.e=p},2616:function(e,t,n){"use strict";n.d(t,"e",function(){return h});var r=n(0),i=n(193);Object(i.n)([{rawString:".od-PolicyTip-container{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.od-PolicyTip-title{font-size:"},{theme:"xLargeFontSize",defaultValue:"20px"},{rawString:";font-weight:100;margin:0px 0px 8px 0px}.od-PolicyTip-description{font-size:"},{theme:"mediumFontSize",defaultValue:"14px"},{rawString:";font-weight:400;margin-top:20px}.od-PolicyTip-header{display:-webkit-box;display:-ms-flexbox;display:flex;margin:20px 0px}.od-PolicyTip-blockedIcon{color:"},{theme:"redDark",defaultValue:"#a4262c"},{rawString:";font-size:21px;padding-top:2px}.od-PolicyTip-headerText{font-size:"},{theme:"largeFontSize",defaultValue:"18px"},{rawString:";font-weight:300;font-weight:600}[dir='ltr'] .od-PolicyTip-headerText{margin-left:12px}[dir='rtl'] .od-PolicyTip-headerText{margin-right:12px}.od-PolicyTip-issue{font-size:"},{theme:"mediumFontSize",defaultValue:"14px"},{rawString:";font-weight:400;margin-bottom:12px}[dir='ltr'] .od-PolicyTip-issue{margin-left:33px}[dir='rtl'] .od-PolicyTip-issue{margin-right:33px}.od-PolicyTip-minorText{font-size:"},{theme:"smallFontSize",defaultValue:"12px"},{rawString:";font-weight:400;color:"},{theme:"neutralSecondary",defaultValue:"#605e5c"},{rawString:"}.od-PolicyTip-learnMoreContainer{display:-webkit-box;display:-ms-flexbox;display:flex}[dir='ltr'] .od-PolicyTip-learnMoreContainer a{padding-right:4px}[dir='rtl'] .od-PolicyTip-learnMoreContainer a{padding-left:4px}.od-PolicyTip-actions{margin-top:60px}.od-PolicyTip-action{font-size:"},{theme:"smallFontSize",defaultValue:"12px"},{rawString:";font-weight:400;margin-bottom:8px}.od-PolicyTip-actionLabel{font-weight:600;cursor:pointer}[dir='ltr'] .od-PolicyTip-label{margin-left:4px}[dir='rtl'] .od-PolicyTip-label{margin-right:4px}.od-PolicyTip-status{display:-webkit-box;display:-ms-flexbox;display:flex;margin-top:34px;margin-bottom:8px}.od-PolicyTip-status{color:"},{theme:"themePrimary",defaultValue:"#0078d4"},{rawString:"}.od-PolicyTip-statusText{font-size:"},{theme:"smallFontSize",defaultValue:"12px"},{rawString:";font-weight:400}[dir='ltr'] .od-PolicyTip-statusText{margin-left:4px}[dir='rtl'] .od-PolicyTip-statusText{margin-right:4px}.od-PolicyTip-justificationInputContainer{overflow-y:auto;max-height:110px}.od-PolicyTip-submitButton{margin-top:8px}.od-PolicyTip-error{margin-top:36px;font-size:"},{theme:"largeFontSize",defaultValue:"18px"},{rawString:";font-weight:300}\n"}]);var s=n(1090),o=n(1761),u=n(1776),a=n(2737),f=n("react-lib"),l=n(18),c=n(580),h=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this;n._onReportClicked=function(){n.setState(Object(r.__assign)(Object(r.__assign)({},n.state),{isLoading:!0,reportButtonClicked:!0}),function(){n.props.onReportClicked()})};n._onOverrideClicked=function(){n.setState(Object(r.__assign)(Object(r.__assign)({},n.state),{overrideButtonClicked:!0}),function(){n.props.onOverrideClicked()})};n._onOverrideSubmitClicked=function(){n.setState(Object(r.__assign)(Object(r.__assign)({},n.state),{isLoading:!0,overrideSubmitClicked:!0}),function(){n.props.onOverrideSubmitClicked(n.state.justificationText)})};n._onJustificationChanged=function(e,t){n.props.overrideRequiresJustification&&n.setState(Object(r.__assign)(Object(r.__assign)({},n.state),{justificationText:t||"",overrideSubmitDisabled:!t}))};n.state={isLoading:!1,justificationText:"",reportButtonClicked:!1,overrideButtonClicked:!1,overrideSubmitClicked:!1,overrideSubmitDisabled:t.overrideRequiresJustification};return n}t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.state.isLoading&&e.confirmationText&&this.setState(Object(r.__assign)(Object(r.__assign)({},this.state),{isLoading:!1}))};t.prototype.componentWillUnmount=function(){this.props.onDismissed()};t.prototype.render=function(){var e=this.props.strings,t=e.noPolicyTipInfoError?f.createElement("div",{className:"od-PolicyTip-container"},f.createElement("span",{className:"od-PolicyTip-error"},e.noPolicyTipInfoError)):f.createElement("div",{className:"od-PolicyTip-container"},f.createElement("span",{className:"od-PolicyTip-description"},e.policyTipDescription),f.createElement("div",{className:"od-PolicyTip-header"},f.createElement(c.e,{iconName:"Blocked2",className:"od-PolicyTip-blockedIcon"}),f.createElement("span",{className:"od-PolicyTip-headerText"},e.headerText)),this._renderIssues(),f.createElement("span",{className:"od-PolicyTip-minorText"},e.lastScannedText),this._renderLearnMore(),f.createElement("div",{className:"od-PolicyTip-actions"},this._renderActions()),this._renderJustificationInput(),this._renderStatus());return f.createElement("div",null,f.createElement("h2",{className:"od-PolicyTip-title"},e.titleText),t)};t.prototype._renderIssues=function(){for(var e=[],t=0,n=0,r=this.props.strings.issues;n<r.length;n++){var i=r[n];e.push(f.createElement("span",{className:"od-PolicyTip-issue",key:t++},i))}return e};t.prototype._renderLearnMore=function(){var e=this.props.strings;if(e.learnMoreUrl){var t=f.createElement("a",{href:e.learnMoreUrl,target:"_blank"},e.learnMoreActionLabel),n=l.formatToArray(e.learnMoreLabel,t);return f.createElement("div",{className:"od-PolicyTip-learnMoreContainer od-PolicyTip-minorText"},n)}};t.prototype._getAction=function(e,t,n,r){if(n)return f.createElement("div",{className:"od-PolicyTip-action"},f.createElement("span",null,"".concat(l.format(e,t))));var i=f.createElement("a",{className:"od-PolicyTip-actionLabel",onClick:r,role:"button",href:"javascript:;"},t),s=l.formatToArray(e,i);return f.createElement("div",{className:"od-PolicyTip-action"},s)};t.prototype._renderActions=function(){var e=this.props,t=this.state,n=e.strings,r=[],i=this._getAction(n.reportLabel,n.reportActionLabel,t.reportButtonClicked,this._onReportClicked);r.push(i);if(n.overrideActionLabel){var s=this._getAction(n.overrideLabel,n.overrideActionLabel,t.overrideButtonClicked,this._onOverrideClicked);r.push(s)}return r};t.prototype._renderStatus=function(){var e=this.props;return this.state.isLoading?f.createElement("div",{className:"od-PolicyTip-status"},f.createElement(u.e,null),f.createElement("span",{className:"od-PolicyTip-statusText"},e.strings.reportInProgressLabel)):e.confirmationText?f.createElement("div",{className:"od-PolicyTip-status"},f.createElement(c.e,{iconName:"CheckMark"}),f.createElement("span",{className:"od-PolicyTip-statusText"},e.confirmationText)):void 0};t.prototype._renderJustificationInput=function(){var e=this.props,t=this.state;if(e.showJustificationInput)return f.createElement("div",{className:"od-PolicyTip-justificationInputContainer"},f.createElement(a.e,{autoAdjustHeight:!0,multiline:!0,value:t.justificationText,onChange:this._onJustificationChanged,underlined:!0,resizable:!1}),!t.overrideSubmitClicked&&f.createElement(o.e,{className:"od-PolicyTip-submitButton",disabled:t.overrideSubmitDisabled,onClick:this._onOverrideSubmitClicked},e.strings.submitButtonLabel))};return t})(s.e)},3460:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(2016),s=n(193);Object(s.n)([{rawString:".od-PolicyTip{height:255px;overflow-x:hidden;position:relative;margin-top:8px}.od-PolicyTip .od-TextField.od-TextField--multiline{margin:0}.od-PolicyTip .od-TextField.od-TextField--multiline .ms-Label{padding-top:0}.od-PolicyTip-loading{text-align:center;position:relative;top:102.5px}.od-PolicyTip-issuesExplanation{margin-bottom:24px}.od-PolicyTip-issuesHeader{padding:0;margin:0 32px}.od-PolicyTip-issuesIcon{padding:2px 8px 0;color:"},{theme:"redDark",defaultValue:"#a4262c"},{rawString:";font-size:17px;height:16px;width:16px;cursor:default}html[dir=ltr] .od-PolicyTip-issuesIcon{float:left}html[dir=rtl] .od-PolicyTip-issuesIcon{float:right}.od-PolicyTip-issueList{margin:8px 0 24px}[dir=ltr] .od-PolicyTip-issueList{padding-left:29px}[dir=rtl] .od-PolicyTip-issueList{padding-right:29px}[dir=ltr] .od-PolicyTip-issueList li{padding-left:3px}[dir=rtl] .od-PolicyTip-issueList li{padding-right:3px}.od-PolicyTip-lastScannedRow{cursor:default;color:"},{theme:"neutralSecondary",defaultValue:"#605e5c"},{rawString:"}.od-PolicyTip-resolveSection{margin-bottom:24px}.od-PolicyTip-resolveHeading{color:"},{theme:"themeSecondary",defaultValue:"#2f69c0"},{rawString:";margin:0;padding:0 0 8px}.lg .od-PolicyTip-resolveButton,.xlg .od-PolicyTip-resolveButton,.xxlg .od-PolicyTip-resolveButton,.xxxlg .od-PolicyTip-resolveButton,.xxxxlg .od-PolicyTip-resolveButton{margin-bottom:2em}html[dir=ltr] .lg .od-PolicyTip-resolveButton,html[dir=ltr] .xlg .od-PolicyTip-resolveButton,html[dir=ltr] .xxlg .od-PolicyTip-resolveButton,html[dir=ltr] .xxxlg .od-PolicyTip-resolveButton,html[dir=ltr] .xxxxlg .od-PolicyTip-resolveButton{float:right}html[dir=rtl] .lg .od-PolicyTip-resolveButton,html[dir=rtl] .xlg .od-PolicyTip-resolveButton,html[dir=rtl] .xxlg .od-PolicyTip-resolveButton,html[dir=rtl] .xxxlg .od-PolicyTip-resolveButton,html[dir=rtl] .xxxxlg .od-PolicyTip-resolveButton{float:left}[dir=ltr] .lg .od-PolicyTip-resolveButton,[dir=ltr] .xlg .od-PolicyTip-resolveButton,[dir=ltr] .xxlg .od-PolicyTip-resolveButton,[dir=ltr] .xxxlg .od-PolicyTip-resolveButton,[dir=ltr] .xxxxlg .od-PolicyTip-resolveButton{margin-left:24px}[dir=rtl] .lg .od-PolicyTip-resolveButton,[dir=rtl] .xlg .od-PolicyTip-resolveButton,[dir=rtl] .xxlg .od-PolicyTip-resolveButton,[dir=rtl] .xxxlg .od-PolicyTip-resolveButton,[dir=rtl] .xxxxlg .od-PolicyTip-resolveButton{margin-right:24px}.md .od-PolicyTip-resolveButton,.sm .od-PolicyTip-resolveButton{display:inline-block;width:100%;margin-top:8px}html[dir=ltr] .md .od-PolicyTip-resolveButton,html[dir=ltr] .sm .od-PolicyTip-resolveButton{text-align:right}html[dir=rtl] .md .od-PolicyTip-resolveButton,html[dir=rtl] .sm .od-PolicyTip-resolveButton{text-align:left}.od-PolicyTip-resolveButton button{min-width:100px}.od-PolicyTip-justifyLabel.ms-Label{padding-bottom:16px}.od-PolicyTip-justifyText{overflow:auto}.od-TextField.od-TextField--multiline .od-PolicyTip-justifyText.od-TextField-field{min-height:150px;font-size:12px}.od-PolicyTip-justifyText--error.od-TextField-field{border-color:"},{theme:"redDark",defaultValue:"#a4262c"},{rawString:"}.od-PolicyTip-justifyError{padding-top:2px;height:2em;color:"},{theme:"redDark",defaultValue:"#a4262c"},{rawString:"}"}]);var o,u=n(2041);(function(e){e[e.loading=0]="loading";e[e.tip=1]="tip";e[e.resolve=2]="resolve";e[e.justify=3]="justify";e[e.status=4]="status";e[e.error=5]="error"})(o||(o={}));var a=o,f=(function(){function e(){}e.getTemplateName=function(t){switch(t){case a.loading:return e.LOADING;case a.tip:return e.TIP;case a.resolve:return e.RESOLVE;case a.justify:return e.JUSTIFY;case a.status:case a.error:return e.MESSAGE;default:return e.LOADING}};e.LOADING="od-policy-tip-loading";e.TIP="od-policy-tip-tip";e.RESOLVE="od-policy-tip-resolve";e.JUSTIFY="od-policy-tip-justify";e.MESSAGE="od-policy-tip-message";return e})(),l=n(3592),c=n(1959),h=n(2754),p=n(2081),d=n(1976),v=n(144),m=n(2011),g=n(1192),y=n(127),b=n(18),w=n(1972),E=0,S=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this;n.loadingSpinnerTagName=u.e.tagName;n.addBindingHandlers({bindableHtml:p.e,keyboard:d.e,visibility:h.e});E++;n.strings=l;n.info=t.policyInfo;n._state=t.state;n.buttonsAvailable=t.buttonsAvailable;n._action=t.action;n._item=t.item;n.justificationText=t.justificationText;n.justificationError=t.justificationError;n.messageText=t.messageText;n.justificationTextId="ms-policy-tip-justify-"+E;n._parentEvt=t.logEvt;n.resolveSections=[{heading:n.strings.ResolveOverrideHeading,descriptionHtml:b.format(n.strings.ResolveOverrideInfo,'<span class="ms-fontWeight-semibold">',"</span>"),buttonText:n.strings.ResolveOverride,buttonClick:function(){return n._overrideClick()},automationId:"PolicyTipDialogOverride",isVisible:function(){return!!n.info().overrideOption},isSpinnerVisible:n.createPureComputed(function(){return!n.buttonsAvailable()&&0===n._action()})},{heading:n.strings.ResolveReportHeading,descriptionHtml:b.format(n.strings.ResolveReportInfo,'<span class="ms-fontWeight-semibold">',"</span>"),buttonText:n.strings.ResolveReport,buttonClick:function(){return n._reportClick()},automationId:"PolicyTipDialogReport",isVisible:function(){return!0},isSpinnerVisible:n.createPureComputed(function(){return!n.buttonsAvailable()&&1===n._action()})}];var r=n.resources.consume(w.t);n.resolveDescriptionFirst=n.createPureComputed(function(){var e=r.formFactorSize();return"Small"===e||"Medium"===e});n.templateName=n.createPureComputed(function(){return f.getTemplateName(n._state())});n.resolutionTemplate=n.createPureComputed(function(){var e=n.info();if(e){var t="";if(e.policyInfoUrl){t=b.format(n.strings.TipLearnMore,'<a href="javascript:" data-bind="click: $component.learnMoreClick.bind($component), keyboard: learnMoreKeyboardInfo">',"</a>");n.learnMoreKeyboardInfo={mappings:{Enter:n.learnMoreClick.bind(n),Space:n.learnMoreClick.bind(n)},preventDefault:!0}}n.openKeyboardInfo={mappings:{Enter:n.openClick.bind(n),Space:n.openClick.bind(n)},preventDefault:!0};return b.format(n.strings.TipText,'<a href="javascript:" data-bind="click: openClick, keyboard: openKeyboardInfo">',"</a>",'<span class="ms-fontWeight-semibold">',"</span>",t)}return""});n.lastScannedText=n.createPureComputed(function(){var e=n.info();if(e)try{return n.strings.TipLastScanned+": "+Object(g.i)(e.lastScanned)}catch(e){}return""});n.subscribe(n._state,function(){var e=document.getElementsByClassName("od-Dialog")[0];e&&Object(m.focusFirstTabStop)(e)});y.e.logData({name:"PolicyTip.DialogRendered",extraData:{screenSize:r.formFactorSize()}},n._parentEvt);return n}t.prototype.openClick=function(e){this._logClick("OpenItem");var t=this.resources.consume(v.e),n=new(this.child(t.DefaultClickAction))({item:this._item,userInvokedItem:!0,sourceEngagement:"PolicyTip.Open.Click"});n.isAvailable()&&n.execute(e);n.dispose()};t.prototype.learnMoreClick=function(){this._logClick("LearnMore");window.open(this.info().policyInfoUrl,"_blank");return!1};t.prototype._overrideClick=function(){this._logClick("Override");this._action(0);return!1};t.prototype._reportClick=function(){this._logClick("Report");this._action(1);return!1};t.prototype._logClick=function(e){var t=a[this._state()];t=t.charAt(0).toUpperCase()+t.slice(1);var n="PolicyTip.".concat(t,"State.").concat(e,".Click");y.e.logData({name:n},this._parentEvt)};return t})(c.t),x=n(1960),T=x.e({tagName:"od-policy-tip-dialog",template:'<div class="od-PolicyTip" data-bind="template:{name:templateName}"></div>',viewModel:S});x.t(f.LOADING,'<div class="od-PolicyTip-loading" data-bind="component:{name:$component.loadingSpinnerTagName,params:{loadingText:strings.TipLoadingText}}"></div>');x.t(f.TIP,'<div class="od-PolicyTip-issuesExplanation">\x3c!--ko if:info().explanationText--\x3e<span data-bind="text:info().explanationText"></span><br><br>\x3c!--/ko--\x3e<span data-bind="bindableHtml:resolutionTemplate"></span></div><i class="od-PolicyTip-issuesIcon ms-Icon ms-Icon--DRM" data-bind="icon:true"></i><h3 class="od-PolicyTip-issuesHeader ms-font-m ms-fontWeight-semibold" data-bind="text:strings.TipIssues"></h3><ul class="od-PolicyTip-issueList" data-bind="foreach:info().issueDescriptions"><li data-bind="text:$data"></li></ul><div class="od-PolicyTip-lastScannedRow" data-bind="attr:{title:strings.TipLastScannedHelp,alt:strings.TipLastScannedHelp},text:lastScannedText"></div>');x.t(f.RESOLVE,'\x3c!--ko foreach:resolveSections--\x3e<div class="od-PolicyTip-resolveSection" data-bind="visible:isVisible()"><h3 class="od-PolicyTip-resolveHeading ms-font-m" data-bind="text:heading"></h3>\x3c!--ko if:$parent.resolveDescriptionFirst--\x3e<div data-bind="html:descriptionHtml"></div>\x3c!--/ko--\x3e<div class="od-PolicyTip-resolveButton"><span class="od-Dialog-actionsLoading" data-bind="component:{name:$component.loadingSpinnerTagName,params:{loadingText:\'\'}},visibility:isSpinnerVisible"></span><button class="od-Dialog-action od-Button od-Button--primary" data-bind="click:buttonClick,keyboard:{mappings:{Enter:buttonClick,Space:buttonClick},preventDefault:true},enable:$parent.buttonsAvailable(),automation:automationId"><span class="od-Button-label" data-bind="text:buttonText"></span></button></div>\x3c!--ko ifnot:$parent.resolveDescriptionFirst--\x3e<div data-bind="html:descriptionHtml"></div>\x3c!--/ko--\x3e</div>\x3c!--/ko--\x3e');x.t(f.JUSTIFY,'<div class="od-TextField od-TextField--multiline"><label class="od-Label od-PolicyTip-justifyLabel" data-bind="attr:{for:justificationTextId},text:strings.OverrideDescription"></label><textarea class="od-PolicyTip-justifyText od-TextField-field" required aria-required="true" maxlength="255" data-bind="value:justificationText,hasFocus:true,attr:{id:justificationTextId,placeholder:strings.OverridePlaceholder},css:{\'od-PolicyTip-justifyText--error\':justificationError}"></textarea></div><div class="od-PolicyTip-justifyError" aria-live="assertive" data-bind="text:justificationError"></div>');x.t(f.MESSAGE,'<div class="od-PolicyTip-section" data-bind="text:messageText"></div>');var N,C=T,k=n(2092),L=n(1979),A=n(72),O=n(59),M=n(40),_=n(1971),D=n(2567),P=n(2020),H=n(31),B=n(1978),j=n(319);(function(e){e[e.None=0]="None";e[e.ItemIdParamMissing=1]="ItemIdParamMissing";e[e.ItemNotFound=2]="ItemNotFound";e[e.NoPolicyTipInitial=3]="NoPolicyTipInitial";e[e.GetItemServerError=4]="GetItemServerError";e[e.GetInfoServerError=5]="GetInfoServerError";e[e.UpdateServerNoResult=6]="UpdateServerNoResult";e[e.UpdateServerError=7]="UpdateServerError";e[e.NoPolicyTipFinal=8]="NoPolicyTipFinal";e[e.NoNotifyAction=9]="NoNotifyAction"})(N||(N={}));var F=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this;n.name="PolicyTip";n._dialogProvider=n.resources.consume(L.e);n._policyTipDataSource=n.resources.consume(A.z);n._panelProvider=n.resources.consume(P.e);n._item=n.observables.create(null);n._isPolicyTipActionRequested=!1;if(t.item){var r=t.item.peek();if(r&&!r.isPlaceholder)n._itemPromise=O.n.resolve([t.item()]);else{var i,s=new j.e;n._itemPromise=s.promise;var o=t.item.subscribe(function(e){if(e&&!e.isPlaceholder){o.dispose();s.resolve([e]);clearTimeout(i)}});i=window.setTimeout(function(){o.dispose();s.reject(new Error("Timed out waiting for the item to be resolved."))},5e3)}}else if(t.itemKey){var u=n.resources.consume(B.resourceKey);n._itemPromise=u.getSpecifiedItems({itemKeys:[t.itemKey],recurseInFolders:!0}).then(function(e){return e.children})}else{n._errorType=N.ItemIdParamMissing;n._itemPromise=O.n.wrapError()}return n}t.prototype.onExecute=function(e,t){var n,r=this;if(this._isPolicyTipActionRequested)return null;this._isPolicyTipActionRequested=!0;if(Object(H.isFeatureEnabled)(H.PolicyTipPanel))return this._itemPromise.then(function(e){if(e[0]){n=e[0];return r._policyTipDataSource.getPolicyTip(n)}}).then(function(e){if(e){var t={item:n,policyTipInfo:e};r._panel=r._panelProvider.requestPanel({component:{name:D.e.tagName,params:t}});return r._panel.wait()}}).then(function(){return r._evtEndObj});this._state=this.observables.create(a.loading);this._buttonsAvailable=this.observables.create(!0);this._justificationText=this.observables.create("");this._justificationError=this.observables.create("");this._messageText=this.observables.create("");this._titleOverride="";this._action=this.observables.create(null);this._info=this.observables.create(null);this._logEvt=t;this._title=this.createPureComputed(function(){var e=r._state();e!==a.status&&e!==a.error&&(r._titleOverride="");switch(e){case a.loading:return l.TipHeadingNoFile;case a.tip:return r._getDocNameTitle();case a.resolve:return l.ResolveTitle;case a.justify:return l.OverrideTitle;case a.status:return r._titleOverride||r._getDocNameTitle();case a.error:return r._titleOverride||l.ErrorTitle}return""});this.subscribe(this._action,function(e){0===e?r._handleOverrideClick():1===e&&r._updateServer()});this._itemPromise.done(function(e){var t=e[0];if(t)if(2!==t.policyTip){r._item(t);r._policyTipDataSource.getPolicyTip(t).done(function(e){if(e){e.issueDescriptions&&e.issueDescriptions.length&&y.e.logData({name:"PolicyTip.ItemWithIssues",extraData:{count:e.issueDescriptions.length}});r._info(e);r._state(a.tip)}else{r._errorType=N.NoPolicyTipInitial;r._showError()}},function(e){r._errorType=N.GetInfoServerError;r._showError(e)})}else{r._errorType=N.NoNotifyAction;r._showError()}else{r._errorType=N.ItemNotFound;r._showError()}},function(e){r._errorType||(r._errorType=N.GetItemServerError);r._showError(e)});var i={item:this._item,policyInfo:this._info,state:this._state,buttonsAvailable:this._buttonsAvailable,justificationText:this._justificationText,justificationError:this._justificationError,messageText:this._messageText,action:this._action,logEvt:this._logEvt},s=function(e){return r.createPureComputed(function(){return r._state()===e})},o=this.observables.create(!1);this.subscribe(o,function(e){r._buttonsAvailable(!e)});var u=this._dialogProvider.requestDialog({title:this._title,size:"Medium",component:{name:C.tagName,params:i},actions:[{name:l.TipResolve,execute:function(){return r._showState(a.resolve,"Resolve")},isVisible:s(a.tip),isAvailable:this._buttonsAvailable,isDefault:!0,icon:new _.e("Save"),automationId:"PolicyTipDialogResolve"},{name:l.TipClose,execute:function(){return r._dismissWithButton("Close")},isVisible:this.createPureComputed(function(){var e=r._state();return e===a.tip||e===a.error}),isAvailable:this._buttonsAvailable,icon:new _.e("Cancel"),automationId:"PolicyTipDialogClose"},{name:l.ResolveBack,execute:function(){return r._showState(a.tip,"Back")},isVisible:s(a.resolve),isAvailable:this._buttonsAvailable,icon:new _.e("Cancel"),automationId:"PolicyTipDialogBack"},{name:l.OverrideSubmit,execute:function(){r._logClick("Submit");return r._submitOverride()},isVisible:s(a.justify),isAvailable:this._buttonsAvailable,isDefault:!0,icon:new _.e("Save"),automationId:"PolicyTipDialogSubmit",isExecuting:o},{name:l.OverrideCancel,execute:function(){return r._dismissWithButton("Cancel")},isVisible:s(a.justify),isAvailable:this._buttonsAvailable,icon:new _.e("Cancel"),automationId:"PolicyTipDialogCancel"},{name:l.StatusOK,execute:function(){r._logClick("OK");return O.n.wrap(2)},isVisible:s(a.status),isAvailable:this._buttonsAvailable,isDefault:!0,icon:new _.e("Save"),automationId:"PolicyTipDialogOK"}]});this._isPolicyTipActionRequested=!0;return u.wait().then(function(){O.n.wrap(r._evtEndObj)},function(){r._dismissedByButton||r._logClick("Dismiss");r._evtEndObj||(r._evtEndObj={resultType:M.e.ExpectedFailure,resultCode:"CanceledOrClosed"});return O.n.wrap(r._evtEndObj)})};t.prototype._showState=function(e,t){this._logClick(t);this._state(e);return O.n.wrap(1)};t.prototype._dismissWithButton=function(e){this._logClick("Close");this._dismissedByButton=!0;this._isPolicyTipActionRequested=!0;return O.n.wrap(3)};t.prototype._logClick=function(e){var t=a[this._state()];t=t.charAt(0).toUpperCase()+t.slice(1);var n="PolicyTip.".concat(t,"State.").concat(e,".Click");y.e.logData({name:n},this._logEvt)};t.prototype._getDocNameTitle=function(){var e=this._item();return b.format(l.TipHeading,e?e.displayName||e.name:"")};t.prototype._handleOverrideClick=function(){this._isPolicyTipActionRequested=!0;if(2!==this._info().overrideOption)return this._submitOverride();this._justificationError("");this._state(a.justify)};t.prototype._submitOverride=function(){if(2!==this._info().overrideOption||this._justificationText()){this._justificationError("");this._updateServer()}else this._justificationError(l.OverrideError);return O.n.wrap(1)};t.prototype._updateServer=function(){var e=this;this._buttonsAvailable(!1);var t={item:this._item(),action:this._action(),justification:this._justificationText()};this._policyTipDataSource.updatePolicy(t).done(function(t){if(null===t){e._errorType=N.UpdateServerNoResult;e._showError()}else if(0===t){e._errorType=N.NoPolicyTipFinal;e._showError()}else{e._titleOverride=l.StatusTitle;1===t?e._messageText(l.StatusReportSuccess):e._messageText(l.StatusOverrideSuccess);e._evtEndObj={resultType:M.e.Success};e._state(a.status);e._buttonsAvailable(!0)}},function(t){e._errorType=N.UpdateServerError;e._showError(t)})};t.prototype._showError=function(e){try{"string"==typeof e&&(e=JSON.parse(e))}catch(e){}var t;switch(this._errorType){case N.ItemNotFound:this._titleOverride=l.FileNotFoundTitle;this._messageText(l.FileNotFoundMessage);t=M.e.Failure;break;case N.NoPolicyTipInitial:case N.NoPolicyTipFinal:this._titleOverride=this._getDocNameTitle();this._messageText(l.StatusNoPolicyTip);t=M.e.ExpectedFailure;break;case N.NoNotifyAction:this._titleOverride=this._getDocNameTitle();this._messageText(k.policyTipBlockText);t=M.e.ExpectedFailure;break;default:this._messageText(e&&e.error&&e.error.message&&e.error.message.value||e&&e.detailedText||"string"==typeof e&&e||l.ErrorText);t=M.e.Failure}this._evtEndObj={resultCode:N[this._errorType],resultType:t,error:this._messageText(),extraData:{error:e}};this._buttonsAvailable(!0);this._state(a.error)};return t})(i.e);t.default=F}}]);