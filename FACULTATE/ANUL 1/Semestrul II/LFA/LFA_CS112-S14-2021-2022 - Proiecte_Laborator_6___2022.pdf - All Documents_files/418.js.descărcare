(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[418],{3751:function(e,t,n){"use strict";n.d(t,"e",function(){return r});function r(e){var t=e.serverRelativeItemUrl,n=e.dataRequestor,r=e.webApiUrl,i=e.duration,s=void 0===i?1:i,o=e.authToken,u=r;u=(u=u.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:t})).method("GetPreAuthorizedAccessUrl",s);return n.getData({url:u.toString(),method:"GET",authToken:o,qosName:"ItemDataSource.getDownloadUrl"}).then(function(e){return e.d.GetPreAuthorizedAccessUrl})}},4831:function(e,t,n){"use strict";n.r(t);n.d(t,"resourceKey",function(){return A});var r=n(0),i=n(641),s=n(59),o=n(348),u=n(115),a=n(642),f=n(471),l=n(379),c=n(3751),h=n(749),p=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,{},{pageContext:t})||this;n._itemUrlHelper=new o.e({},{pageContext:t});n._apiUrlHelper=new a.e({},{pageContext:t,itemUrlHelper:n._itemUrlHelper});return n}t.prototype.downloadItems=function(e){var t=e.items[0];return this.getDownloadUrl(t,null,{downloadType:0}).then(function(e){window.location.href=e})};t.prototype.getDownloadUrl=function(e,t,n){var r=this;void 0===n&&(n={});var i=n.downloadType,o=void 0===i?0:i,a=this._itemUrlHelper.getItemUrlParts(e.key);if(1===o)return s.n.resolve(Object(h.e)(a.fullItemUrl));if(3===o){var p=void 0;p=e.video?24:1;var d=this._apiUrlHelper.build().webByItemUrl(a);return Object(c.e)({dataRequestor:this.dataRequestor,webApiUrl:d,duration:p,serverRelativeItemUrl:a.serverRelativeItemUrl})}if(2===o)return a.isCrossDomain&&n.authToken?this.dataRequestor.getData({url:this._apiUrlHelper.contextInfoUrl(a.fullItemUrl),method:"POST",qosName:"GetContextInfo",authToken:n.authToken}).then(function(e){var t=e.d.GetContextWebInformation.WebFullUrl,n=new f.t({webAbsoluteUrl:t}).build().segment("web").methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:a.serverRelativeItemUrl}).segment("OpenBinaryStream");return s.n.resolve(n.toString())}):s.n.resolve(this.getBinaryStreamApiUrl(a).toString());var v=void 0;if(t||a.siteRelation===u.r.sameSite){var m=void 0;if(t){m=this._itemUrlHelper.getItemUrlParts(t.key).fullItemUrl}else m=this._pageContext.webAbsoluteUrl;v=s.n.resolve(m)}else v=this.dataRequestor.getData({url:this._apiUrlHelper.contextInfoUrl(a.fullItemUrl),method:"POST",qosName:"GetContextInfo"}).then(function(e){return e.d.GetContextWebInformation.WebFullUrl});return v.then(function(e){return"".concat(e,"/").concat(r._pageContext.layoutsUrl,"/download.aspx?").concat(Object(l.e)({SourceUrl:a.serverRelativeItemUrl}))})};t.prototype.getBinaryStreamApiUrl=function(e){var t=this._apiUrlHelper.build().webByItemUrl(e);t=(t=t.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:e.serverRelativeItemUrl})).segment("OpenBinaryStream");var n=this._pageContext.authToken;n&&(t=t.oDataParameter("access_token",n));return t};return t})(i.t),d=n(572),v=n(123),m=n(101),g=n(1196),y=n(1973),b=n(72),w=n(35),E=n(31),S=n(2304),x=n(187),T=n(168),N=n(397),C=n(27),k=n(15),L=(function(){function e(e,t){this._common=new p(t.pageContext);this._dataRequestor=new t.dataRequestorType({});this._graphDataSource=t.graphDataSource;this._itemParentHelper=t.itemParentHelper;this._navigation=t.navigation;this._itemUrlHelper=t.itemUrlHelper;this._identityDataSource=t.identityDataSource}e.prototype.getDownloadUrl=function(e,t){void 0===t&&(t={});var n=Object(d.r)(this._itemParentHelper.getFacetedAncestorOrSelf(e,"subsite"));return this._common.getDownloadUrl(Object(S.n)(e),Object(S.n)(n),t)};e.prototype.getItemContents=function(e){var t=this;return this.getDownloadRequestParameters(e).then(function(e){var n=e.headers,r=n&&n.Authorization,i=r&&r.slice(7);return t._dataRequestor.getData({url:e.url,method:"GET",noRedirect:!0,qosName:"ItemDataSource.getItemContents",responseType:"blob",needsRequestDigest:!1,authToken:i})})};e.prototype.getDownloadRequestParameters=function(e,t){var n=this,r=this._itemUrlHelper.getItemUrlParts(e.key),i=new T.e(r.normalizedItemUrl);return r.isCrossDomain?this._identityDataSource.getSharePointToken(i.authority).then(function(t){var r=t.accessToken;return n.getDownloadUrl(e,{downloadType:2,authToken:r}).then(function(e){return{url:e,headers:{Authorization:"bearer ".concat(r)}}})}):this.getDownloadUrl(e,{downloadType:2}).then(function(e){return{url:e,withCredentials:!0}})};e.prototype.downloadItems=function(e){var t=this,n=e.items[0];return(Object(E.isFeatureEnabled)(E.UseVroomDownload)?this._graphDataSource.getDownloadUrl(n,{useDirectEndpoint:!0}):this.getDownloadUrl(n,{downloadType:0})).then(function(e){if(k.e.isActivated("f00a3568-c0f5-401d-b8da-584dfc24d99f","06/28/2021","Excel download issue"))t._navigation.navigateTo(e);else{var n=t._initIframe(e);setTimeout(function(){window.document.body.removeChild(n)},2e4)}})};e.prototype.isDownloadBlocked=function(e){return!C.e.hasPermission(e.permissions,C.e.openItems)};e.prototype._initIframe=function(e){var t=document.createElement("iframe");t.src=e;t.style.display="none";window.document.body.appendChild(t);return t};return e})(),A=(t.default=L,Object(m.s)("DownloadDataSource",L,{dataRequestorType:g.n,graphDataSource:b.b,itemParentHelper:y.e,navigation:v.e,pageContext:w.h,itemUrlHelper:x.a,identityDataSource:N.t}))}}]);