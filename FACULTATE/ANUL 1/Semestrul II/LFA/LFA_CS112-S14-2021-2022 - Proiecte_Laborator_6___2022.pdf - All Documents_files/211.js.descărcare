(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[211],{5013:function(e,t,n){"use strict";n.r(t);n.d(t,"OpenInImageEditorHandler",function(){return x});var r=n(0),i=n(173),s=n(2096),o=n(1065),u=n(59),a=n(72),f=n(1974),l=n(2017),c=n(38),h=n(93),p=n(2227),d=n(31),v=n(873),m=n(871),g=n(2475),y=n(228),b={jpg:"image/jpg",jpeg:"image/jpeg"},w={png:"image/png"},E={heic:"image/heic",heif:"image/heif"},S={bmp:"image/bmp",emf:"image/emf",gif:"image/gif",tiff:"image/tiff",tif:"image/tif",webp:"image/webp",wmf:"image/wmf"},x=(function(e){Object(r.__extends)(t,e);function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;n._itemSelectionHelper=new(n.child(f.e))({allowMultiSelect:!1,canFallback:!0});n._isOneDriveWinApp=Object(h.e)();n._urlDataSource=n.resources.consume(a.de);n._itemCommandHelper=n.resources.consume(l.t);n._platformDetection=n.resources.consume(i.e);n._identityDataSource=n.resources.consume(a.E);n._coachmarkProvider=n.resources.consume(g.resourceKey.optional);n.state=n.createPureComputed(n._computeState);return n}t.prototype.getParams=function(){return this._itemSelectionHelper.resolveFirst().then(function(e){return{item:e}})};t.prototype._computeState=function(){return{isAvailable:this._isAvailable()}};t.prototype._isAvailable=function(){var e=this._itemSelectionHelper.firstItem();if(!e)return!1;if(e.video&&e.video.burstPhotoType)return!1;var t=this._itemCommandHelper.isCommandSupported(e,p.o),n=this._isSupportedFileType(e),r=this._itemSelectionHelper.currentItem(),i=this._urlDataSource.getKeyParams(r.key),s=this._urlDataSource.getQueryType(i),o=this._shouldEnableImageEditor()&&t&&n&&(!this._platformDetection.isIE||Object(d.isFeatureEnabled)(d.EnableEditUtilityControlIE))&&(!this._platformDetection.isSafari||Object(d.isFeatureEnabled)(d.EnableEditUtilityControlSafari))&&(!this._platformDetection.isMobile||Object(d.isFeatureEnabled)(d.EnableEditUtilityControlMobile))&&!!e&&0===e.sharingRole&&s!==c.e.SharedWithMe&&!this._isOneDriveWinApp&&!this._urlDataSource.isRecycleBin(s)&&4!==e.itemStatus&&3!==e.itemStatus;o&&Object(d.isFeatureEnabled)(d.EnableEditControlTeachingBubble)&&!Object(d.isFeatureEnabled)(d.MentionTeachingUIAA)&&!Object(d.isFeatureEnabled)(d.EnableExpirationSectionForTMR)&&this._coachmarkProvider.setCampaign(m.PHOTO_EDIT);return o};t.prototype._shouldEnableImageEditor=function(){if(Object(d.isFeatureEnabled)(d.EnableEditUtilityControl))return!0;if(Object(d.isFeatureEnabled)(d.EnableEditControlExperimentAA)){if(this._identityDataSource){var e=this._identityDataSource.getIdentity();e&&v.t.init({userLoginName:e.email})}var t={name:"EnableEditControlExperiment",startDate:"2/09/2021",version:v.e.v2};return new v.t(t,d.EnableEditControlExperimentAB).isOn()}return!1};t.prototype._isSupportedFileType=function(e){if(!(function(e){Object(d.isFeatureEnabled)(d.EnableEditAllImageFormats)&&C.forEach(function(e){N.push(e);N.push(e.toUpperCase())});if(Object(d.isFeatureEnabled)(d.EnableEditPNG)){N.push(".png");N.push(".PNG")}if(Object(d.isFeatureEnabled)(d.EnableEditHEIC)){N.push(".heic");N.push(".heif");N.push(".HEIC");N.push(".HEIF")}return N.some(function(t){return e.toLowerCase()===t})})(e.extension||""))return!1;if(e&&e.extension&&(e.type===y.e.File||e.type===y.e.Media)){var t=e.extension;t=((t&&"."===t[0]?t.substring(1):t)||"").toLowerCase();if(b.hasOwnProperty(t))return!0;if(Object(d.isFeatureEnabled)(d.EnableEditPNG)&&w.hasOwnProperty(t))return!0;if(Object(d.isFeatureEnabled)(d.EnableEditHEIC)&&E.hasOwnProperty(t))return!0;if(Object(d.isFeatureEnabled)(d.EnableEditAllImageFormats)&&S.hasOwnProperty(t))return!0}return!1};return t})(o.default),T=Object(s.e)({name:"OpenInImageEditor",source:{moduleDefinition:{path:"./OpenInImageEditorExecutor",getModule:function(){return u.n.resolve(n.ee([212],4793))}}},handlerType:x}),N=[".jpg",".jpeg",".JPG",".JPEG"],C=[".bmp",".emf",".gif",".tiff",".tif",".webp",".wmf"];t.default=T}}]);